jQuery(document).ready(function(m){"use strict";var w,k,y=topAtts,n=m("#"+y.id),t=m("#year-select"),x=n.find(".no-data"),i=m(".top-data-content"),_=m(".article-photo-credits-container"),a={edits:[],views:[]};function r(p,e){var f="views"===e?"wiki":"wiki_db",u=p.map(function(e){return e[f]}),h="views"===e?"views":"edits",g="views"===e?"pageviews":"edits",v="views"===e?"daily_views":"daily_edits";console.log(p,e),_.find(".article-photo-credits").text(""),_.hide(),i.each(function(){var e=m(this),t=m(this).attr("id"),i=p.find(function(e){return e[f]===t}),n="";if(x.hide(),e.hide(),-1<u.indexOf(t)){var a=i["desc_"+y.lang.replaceAll("wiki","")].replaceAll('"',""),r=i.pagetitle.replaceAll("_"," "),d=i.image_file,s=i.file_name.replace("File:",""),c=d3.format(",")(i[g]),l=i[v].split("_").map(function(e){return parseInt(e,10)}),o="#"+t+"-graph";m(o).empty(),function(e,t){var i,n;i=d3.scaleLinear().domain([0,d3.max(e,function(e){return e})]).nice().range([40,6]),n=d3.scaleLinear().domain([0,e.length]).range([0,300]),w=d3.line().defined(function(e){return!isNaN(e)}).curve(d3.curveBasis).x(function(e,t){return n(t)}).y(function(e){return i(e)}),(k=d3.select(t).append("svg").attr("viewBox",[0,0,300,46])).append("g").attr("class","bg-line-graph").append("line").style("stroke","#c8ccd1").attr("x1",0).attr("x2",300).attr("y1",40).attr("y2",40),k.append("g").attr("class","line-graph").append("path").datum(e).attr("fill","none").attr("stroke","#72777D").attr("stroke-width",1.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",w)}(l,o),e.find(".heading").text(r),e.find(".desc").text(a),e.find(".details").attr("href","https://"+i[f].replace("wiki","")+".wikipedia.org/wiki/"+i.pagetitle).attr("target","_blank"),e.find(".data span").text(c+" "+h),0<s.length&&0<d.length?(e.find(".article-image").removeClass("article-image-fallback").css("background-image","url("+d+")"),e.find(".article-image-link").attr("href",i.image_page),n+=0<i.artist.length?", "+i.artist:"",n+=0<i.license.length?", "+i.license:"",_.find(".article-photo-credits").append(m("<div></div>").append(m("<a>").text(s).attr("href",i.image_page)).append(m("<span></span>").text(n)))):(e.find(".article-image-link > div").unwrap(),e.find(".article-image").attr("style","").addClass("article-image-fallback")),e.fadeIn(),_.show()}else x.show()})}function d(){var e=n.find("input:checked").val();0<a[e].length?s(e):function(e){"edits"===e?d3.csv(y.url_edits,function(e){return e}).then(function(e){a.edits=e,d()}):d3.csv(y.url_views,function(e){return e}).then(function(e){a.views=e,d()})}(e),t.find("option").each(function(){var t=parseInt(m(this).val(),10);0<a[e].filter(function(e){return parseInt(e.year,10)===t}).length?m(this).removeAttr("disabled"):m(this).attr("disabled","true")})}function s(e){var t="",i="string"==typeof e?e:n.find("input:checked").val();m("#year-select option:selected").each(function(){t+=m(this).text()+" "}),r(a[i].filter(function(e){return parseInt(e.year,10)===parseInt(t,10)}),i)}i.each(function(){m(this).hide()}),d(),t.change(s),n.find("input").change(d)});