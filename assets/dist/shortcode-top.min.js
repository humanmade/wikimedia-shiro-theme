jQuery(document).ready(function(k){"use strict";var v,w,m,b=topAtts,a=k("#"+b.id),i=k("#year-select"),x=a.find(".no-data"),t=k(".top-data-content"),y=k(".article-photo-credits-container"),n={edits:[],views:[]};function r(o,e){var f="views"===e?"wiki":"wiki_db",p=o.map(function(e){return e[f]}),u="views"===e?"views":"edits",h="views"===e?"pageviews":"edits",g="views"===e?"daily_views":"daily_edits";console.log(o,e),y.find(".article-photo-credits").text(""),y.hide(),t.each(function(){var e=k(this),i=k(this).attr("id"),t=o.find(function(e){return e[f]===i}),a="";if(x.hide(),e.hide(),-1<p.indexOf(i)){var n=t["desc_"+b.lang.replaceAll("wiki","")].replaceAll('"',""),r=t.pagetitle.replaceAll("_"," "),d=t.image_file,c=d3.format(",")(t[h]),s=t[g].split("_").map(function(e){return parseInt(e,10)}),l="#"+i+"-graph";k(l).empty(),function(e,i){var t,a,n=300/e.length;t=d3.scaleLinear().domain([0,d3.max(e,function(e){return e})]).nice().range([40,6]),a=d3.scaleLinear().domain([0,e.length]).range([0,300]),v=d3.scaleLinear().domain([0,d3.max(e,function(e){return e})]).nice().range(["#f8f9fa","#202122"]),w=d3.line().defined(function(e){return!isNaN(e)}).curve(d3.curveCardinal.tension(.5)).x(function(e,i){return a(i)}).y(function(e){return t(e)}),(m=d3.select(i).append("svg").attr("viewBox",[0,0,300,46])).append("g").append("path").datum(e).attr("fill","none").attr("stroke","#72777D").attr("stroke-width",1).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",w),m.append("g").selectAll("rect").data(e).join("rect").attr("width",n).attr("height",6).style("fill",function(e){return v(e)}).attr("x",function(e,i){return i*n}).attr("y",40)}(s,l),e.find(".heading").text(r),e.find(".desc").text(n+" ").append(k("<a></a>").attr("href","https://"+t[f].replace("wiki","")+".wikipedia.org/wiki/"+t.pagetitle).attr("target","_blank").text(function(e){var i="";switch(e){case"enwiki":i="English Wikipedia";break;case"arwiki":i="Arabic Wikipedia";break;case"dewiki":i="German Wikipedia";break;case"eswiki":i="Spanish Wikipedia";break;case"frwiki":i="French Wikipedia";break;case"ruwiki":i="Russian Wikipedia";break;case"zhwiki":i="Chinese Wikipedia";break;default:i="Wikipedia"}return i}(t[f]))),e.find(".data span").text(c+" "+u),0<d.length?(e.find(".article-image").removeClass("article-image-fallback").css("background-image","url("+d+")"),e.find(".article-image-link").attr("href",t.image_page),a+=0<t.artist.length?", "+t.artist:"",a+=0<t.license.length?", "+t.license:"",y.find(".article-photo-credits").append(k("<div></div>").append(k("<a>").text(t.file_name.replace("File:","")).attr("href",t.image_page)).append(k("<span></span>").text(a)))):(e.find(".article-image-link > div").unwrap(),e.find(".article-image").attr("style","").addClass("article-image-fallback")),e.fadeIn(),y.show()}else x.show()})}function d(){var e=a.find("input:checked").val();0<n[e].length?c(e):function(e){"edits"===e?d3.csv(b.url_edits,function(e){return e}).then(function(e){n.edits=e,d()}):d3.csv(b.url_views,function(e){return e}).then(function(e){n.views=e,d()})}(e),i.find("option").each(function(){var i=parseInt(k(this).val(),10);0<n[e].filter(function(e){return parseInt(e.year,10)===i}).length?k(this).removeAttr("disabled"):k(this).attr("disabled","true")})}function c(e){var i="",t="string"==typeof e?e:a.find("input:checked").val();k("#year-select option:selected").each(function(){i+=k(this).text()+" "}),r(n[t].filter(function(e){return parseInt(e.year,10)===parseInt(i,10)}),t)}t.each(function(){k(this).hide()}),d(),i.change(c),a.find("input").change(d)});