{"version":3,"sources":["datavis.min.js"],"names":["jQuery","document","ready","$","each","id","$id","margin","numFormat","d3","format","width","shift","x","profInRowMin","y","maxFeature1","data","maxFeature2","profInRow","Math","max","floor","screenWidth","minWidth","smallBp","masterunit","moreHorUnits","dataStart","dataEnd","labels","legendLabelDistance","icons","except","exceptLang","exceptHeightMulti","height","yPos","d","i","gutter","xPos","fAttr","sel","shape","attr","parseFloat","selectAll","nodes","getAttribute","svg","editors","articles","views","tooltip","container","select","checks","aspect","mappedData","map","p","index","unitSum","remain","specHorUnits","rows","ceil","unitArray","h","push","value","slice","length","Rows","ddata","maxRows","editorScale","scaleLinear","domain","range","articleScale","viewsUnitScale","viewsYScale","viewsXScale","horUnits","minHeight","append","window","resize","targetWidth","node","getBoundingClientRect","call","g","join","e","normalPosX","exceptPosX","posX","smallPosX","a","ix","ry","normalPosY","exceptPosY","transX","transY","offset","labelX","labelY","g1","text","g2","style","borderHeight","endX","v","datalabelText","d0","aObj","vx1","vxCenter","vy1","lastRowOverHalf","customLegend","y2","class","highlight","name","marginBottom","on","_","hover","click","checkBoxStates","transition","editXPos","artXPos","artW","posInRow","min","size","shiftSmScreens","hoverLabels","path","labelPos","is","$elem","fadeIn","fadeOut","addVis","dataProfiles","this","lineChart","isMobile","origWidth","strokeWidth","circleDiameter","accentColorClass","timeFormatPrefs","month","day","year","parseTimeFormat","timeParse","dataRaw","wp","date","callout","evnt","rect","t","split","bbox","getBBox","w","ttipMar","ticks","scaleTime","nice","extent","axisBottom","timeMonth","tickFormat","timeFormat","remove","axisLeft","tickSize","datum","line","filter","event","enter","hoverD","mx","bisect","bisector","left","invert","b","bisectDate","mouse","context","toLocaleString","undefined","css"],"mappings":"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","file":"../datavis.min.js","sourcesContent":["/* global d3 */\n/* eslint-disable no-magic-numbers */\n\njQuery(document).ready(function($) {\n\n\t'use strict';\n\n\tfunction dataProfiles(id) {\n\t\tvar $id = $(\"#\" + id),\n\t\t\tmargin = 10,\n\t\t\tstrokeW = 2,\n\t\t\tnumFormat = d3.format(\",\"),\n\t\t\twidth = $id.width(),\n\t\t\tprofInRowMin = 2,\n\t\t\tidealX = 190,\n\t\t\tshift = { x: width < profInRowMin*idealX ? width/2 - margin : idealX, y: 125 },\n\t\t\tmaxFeature1 = $id.data(\"max-feature-1\") ? $id.data(\"max-feature-1\") : 90,\n\t\t\tmaxFeature2 = $id.data(\"max-feature-2\") ? $id.data(\"max-feature-2\") : 90,\n\t\t\tprofInRow = Math.max(Math.floor(width / shift.x), profInRowMin),\n\t\t\tscreenWidth = $(\"body\").width(),\n\t\t\tminWidth = idealX * profInRow,\n\t\t\tsmallBp = 500, // per _variables.scss\n\t\t\tmasterunit = $id.data(\"chart-masterunit\") ? $id.data(\"chart-masterunit\") : 500000,\n\t\t\thorUnits = 5,\n\t\t\tmoreHorUnits = width < minWidth ? 24 : 30,\n\t\t\tdata = $id.data(\"chart-raw\"),\n\t\t\tdataStart = $id.data(\"slice-start\"),\n\t\t\tdataEnd = $id.data(\"slice-end\"),\n\t\t\t// This is setup so properties/labels don't matter\n\t\t\t// But labels map to this order: circle, rectangle, ellipses\n\t\t\tlabels = $id.data(\"chart-labels\"),\n\t\t\tlegendLabelDistance = 45,\n\t\t\ticons = $id.data(\"chart-icons\"),\n\t\t\texcept = $id.data(\"chart-except\"),\n\t\t\texceptI = 0,\n\t\t\texceptLang = except ? data[labels[exceptI]] : \"\",\n\t\t\texceptHeightMulti = 3.5,\n\t\t\theight = except ? shift.y * exceptHeightMulti : yPos(null, dataEnd - dataStart -1) + shift.y;\n\n\t\tfunction yPos(d, i) {\n\t\t\tvar gutter = margin * 6,\n\t\t\t\ttopmargin = except ? 0 : margin * 5;\n\t\t\treturn topmargin + (shift.y + gutter) * Math.floor(i / profInRow);\n\t\t}\n\n\t\tfunction xPos(d, i) {\n\t\t\treturn i % profInRow * shift.x;\n\t\t}\n\n\t\tfunction fAttr(sel, shape, i, attr) {\n\t\t\treturn parseFloat(sel.selectAll(shape).nodes()[i].getAttribute(attr));\n\t\t}\n\n\t\tfunction addVis() {\n\t\t\tif (!data) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfunction editorsConstruct(g) {\n\t\t\t\treturn g\n\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t.attr(\"class\", \"profile-feature1\")\n\t\t\t\t\t.selectAll(\"circle\")\n\t\t\t\t\t.data(ddata)\n\t\t\t\t\t.join(\"circle\")\n\t\t\t\t\t.attr(\"cx\", function(d, i) {return except ? xPos(d, i) + Math.max(width/4, editorScale(d[labels[1]]) + margin) : xPos(d, i) + editorScale(d[labels[1]])})\n\t\t\t\t\t.attr(\"cy\", function(d, i) {return yPos(d, i) + editorScale(d[labels[1]])})\n\t\t\t\t\t.attr(\"r\", function(d) {return editorScale(d[labels[1]])})\n\t\t\t}\n\n\t\t\tfunction articlesConstruct(g, e) {\n\t\t\t\treturn g\n\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t.attr(\"class\", \"profile-feature2\")\n\t\t\t\t\t.selectAll(\"rect\")\n\t\t\t\t\t.data(ddata)\n\t\t\t\t\t.join(\"rect\")\n\t\t\t\t\t.attr(\"x\", function(d, i) {\n\t\t\t\t\t\tvar normalPosX = fAttr(e, \"circle\", i, \"cx\") + fAttr(e, \"circle\", i, \"r\") + margin/2,\n\t\t\t\t\t\t\texceptPosX = width*0.4 + (width/2-articleScale(d[labels[2]])*0.75)/2,\n\t\t\t\t\t\t\tposX = except ? exceptPosX : normalPosX,\n\t\t\t\t\t\t\tsmallPosX = fAttr(e, \"circle\", i, \"cx\") + fAttr(e, \"circle\", i, \"r\") + margin * 3;\n\t\t\t\t\t\treturn width < minWidth && except ? smallPosX : posX;\n\t\t\t\t\t})\n\t\t\t\t\t.attr(\"y\", function(d, i) {return yPos(d, i)})\n\t\t\t\t\t.attr(\"width\", function(d) {return articleScale(d[labels[2]])*0.75})\n\t\t\t\t\t.attr(\"height\", function(d) {return articleScale(d[labels[2]])})\n\t\t\t\t\t.attr(\"rx\", function(d) {return articleScale(d[labels[2]])*0.08})\n\t\t\t\t\t.attr(\"ry\", function(d) {return articleScale(d[labels[2]])*0.08});\n\t\t\t}\n\n\t\t\tfunction viewsConstruct(g, e, a) {\n\t\t\t\tg.attr(\"class\", \"profile-feature3\");\n\t\t\t\t/* eslint-disable no-loop-func, one-var */\n\t\t\t\tfor (var ix = 0; ix < ddata.length; ix++) {\n\t\t\t\t\tvar ry = viewsUnitScale(masterunit) / 3 * 2,\n\t\t\t\t\t\tnormalPosX = fAttr(a, \"rect\", ix, \"x\") + fAttr(a, \"rect\", ix, \"width\") + margin,\n\t\t\t\t\t\tnormalPosY = fAttr(a, \"rect\", ix, \"y\") + ry,\n\t\t\t\t\t\texceptPosX = (width - viewsXScale(moreHorUnits)) / 2, // center\n\t\t\t\t\t\texceptPosY = fAttr(e, \"circle\", ix, \"cx\") + fAttr(e, \"circle\", ix, \"r\") + legendLabelDistance + margin * 2,\n\t\t\t\t\t\ttransX = except ? exceptPosX : normalPosX,\n\t\t\t\t\t\ttransY = except ? exceptPosY : normalPosY;\n\n\t\t\t\t\tg\n\t\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t\t.attr(\"class\", \"viewsContainer\")\n\t\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t\t.selectAll(\"ellipse\")\n\t\t\t\t\t\t.data(ddata[ix].unitArray)\n\t\t\t\t\t\t.join(\"ellipse\")\n\t\t\t\t\t\t.attr(\"class\", \"views-\" + ix)\n\t\t\t\t\t\t.attr(\"cx\", function(d) {return transX + viewsXScale(d.x)})\n\t\t\t\t\t\t.attr(\"cy\", function(d) {return transY + viewsYScale(d.y)})\n\t\t\t\t\t\t.attr(\"rx\", function(d) {return viewsUnitScale(d.value)})\n\t\t\t\t\t\t.attr(\"ry\", function(d) {return viewsUnitScale(d.value)/3*2});\n\t\t\t\t\t/* eslint-disable no-loop-func, one-var */\n\t\t\t\t}\n\n\t\t\t\treturn g;\n\t\t\t}\n\n\t\t\tfunction labelConstruct(g, e, offset) {\n\t\t\t\tvar labelX = except ? margin*exceptHeightMulti + margin : margin * 2,\n\t\t\t\t\tlabelY = except ? height - margin : shift.y*0.75 + margin;\n\t\t\t\treturn g\n\t\t\t\t\t.call(function(g1) {\n\t\t\t\t\t\treturn g1\n\t\t\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t\t\t.attr(\"class\", \"main-labels\")\n\t\t\t\t\t\t\t.selectAll(\"text\")\n\t\t\t\t\t\t\t.data(ddata)\n\t\t\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t\t\t\t\t\t.attr(\"dy\", -5) // create some padding at the bottom\n\t\t\t\t\t\t\t.attr(\"x\", function(d, i) {return screenWidth < smallBp ? xPos(d, i) + margin : xPos(d, i) + labelX})\n\t\t\t\t\t\t\t.attr(\"y\", function(d, i) {return yPos(d, i) + labelY})\n\t\t\t\t\t\t\t.text(function(d) {return labels.length > 4 ? d[labels[4]] : d[labels[0]] })\n\t\t\t\t\t})\n\t\t\t\t\t.call(function(g2) {\n\t\t\t\t\t\treturn g2\n\t\t\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t\t\t.attr(\"class\", \"main-label-ranks\")\n\t\t\t\t\t\t\t.style(\"display\", \"none\")\n\t\t\t\t\t\t\t.selectAll(\"text\")\n\t\t\t\t\t\t\t.data(ddata)\n\t\t\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t\t\t\t\t\t.attr(\"dy\", -30) // above mainlabel\n\t\t\t\t\t\t\t.attr(\"x\", function(d, i) {return screenWidth < smallBp ? xPos(d, i) + margin : xPos(d, i) + labelX})\n\t\t\t\t\t\t\t.attr(\"y\", function(d, i) {return yPos(d, i) + labelY})\n\t\t\t\t\t\t\t.text(function(d, i) {return i + 1 + offset});\n\t\t\t\t\t})\n\t\t\t}\n\n\n\t\t\tfunction borderleft(g) {\n\t\t\t\tvar borderHeight = except ? height : shift.y - margin,\n\t\t\t\t\tendX = except ? margin * exceptHeightMulti : margin;\n\t\t\t\treturn g\n\t\t\t\t\t.attr(\"stroke-width\", strokeW)\n\t\t\t\t\t.attr(\"class\", \"borderleft\")\n\t\t\t\t\t.selectAll(\"line\")\n\t\t\t\t\t.data(ddata)\n\t\t\t\t\t.join(\"line\")\n\t\t\t\t\t.attr(\"x1\", function(d, i) {return xPos(d, i) + strokeW})\n\t\t\t\t\t.attr(\"x2\", function(d, i) {return screenWidth < smallBp ? xPos(d, i) + strokeW : xPos(d, i) + endX})\n\t\t\t\t\t.attr(\"y1\", function(d, i) {return yPos(d, i)})\n\t\t\t\t\t.attr(\"y2\", function(d, i) {return yPos(d, i) + borderHeight});\n\t\t\t}\n\n\t\t\tfunction legendConstruct(g, e, a, v) {\n\t\t\t\tvar datalabelText,\n\t\t\t\t\td0 = ddata[0],\n\t\t\t\t\taObj = {\n\t\t\t\t\t\tx: fAttr(a, \"rect\", 0, \"x\"),\n\t\t\t\t\t\ty: fAttr(a, \"rect\", 0, \"y\"),\n\t\t\t\t\t\tw: fAttr(a, \"rect\", 0, \"width\"),\n\t\t\t\t\t\th: fAttr(a, \"rect\", 0, \"height\"),\n\t\t\t\t\t},\n\t\t\t\t\tvx1 = fAttr(v, \"ellipse\", moreHorUnits-1, \"cx\"),\n\t\t\t\t\tvxCenter = fAttr(v, \"ellipse\", Math.floor(moreHorUnits/2) - 1, \"cx\"),\n\t\t\t\t\tvy1 = fAttr(v, \"ellipse\", moreHorUnits * (d0.Rows - 1), \"cy\"),\n\t\t\t\t\tlastRowOverHalf = moreHorUnits * d0.Rows % d0.unitArray.length > Math.ceil(moreHorUnits/2) + 1,\n\t\t\t\t\tmarginBottom = 60,\n\t\t\t\t\tcustomLegend = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tx: fAttr(e, \"circle\", 0, \"cx\"),\n\t\t\t\t\t\t\ty: fAttr(e, \"circle\", 0, \"cy\") + fAttr(e, \"circle\", 0, \"r\") - margin,\n\t\t\t\t\t\t\ty2: height - marginBottom,\n\t\t\t\t\t\t\th: legendLabelDistance,\n\t\t\t\t\t\t\tclass: \"profile-feature1\",\n\t\t\t\t\t\t\thighlight: true,\n\t\t\t\t\t\t\tname: [numFormat(d0[labels[1]]) + \" \" + labels[1]]\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tx: aObj.x + aObj.w * 0.5,\n\t\t\t\t\t\t\ty: aObj.y + aObj.h - margin,\n\t\t\t\t\t\t\ty2: height - marginBottom,\n\t\t\t\t\t\t\th: legendLabelDistance,\n\t\t\t\t\t\t\tclass: \"profile-feature2\",\n\t\t\t\t\t\t\thighlight: true,\n\t\t\t\t\t\t\tname: [numFormat(d0[labels[2]]) + \" \" + labels[2]]\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tx: vxCenter,\n\t\t\t\t\t\t\ty: lastRowOverHalf ? vy1 : vy1 + margin,\n\t\t\t\t\t\t\ty2: height - marginBottom * 1.5,\n\t\t\t\t\t\t\th: legendLabelDistance,\n\t\t\t\t\t\t\tclass: \"profile-feature3\",\n\t\t\t\t\t\t\thighlight: true,\n\t\t\t\t\t\t\tname: [numFormat(d0[labels[3]]) + \" \" + labels[3]]\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tx: vx1,\n\t\t\t\t\t\t\ty: vy1 - viewsUnitScale.range()[1] * 2,\n\t\t\t\t\t\t\ty2: height - marginBottom * 2,\n\t\t\t\t\t\t\th: legendLabelDistance/2,\n\t\t\t\t\t\t\tclass: \"profile-feature3\",\n\t\t\t\t\t\t\thighlight: false,\n\t\t\t\t\t\t\tname: [numFormat(masterunit), labels[3]]\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\n\t\t\t\tg\n\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t.attr(\"class\", \"data-label-lines\")\n\t\t\t\t\t.selectAll(\"line\")\n\t\t\t\t\t.data(customLegend)\n\t\t\t\t\t.join(\"line\")\n\t\t\t\t\t.attr(\"class\", function(d) {return d.class})\n\t\t\t\t\t.attr(\"x1\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"x2\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"y1\", function(d) {return d.y})\n\t\t\t\t\t.attr(\"y2\", function(d) {return d.y + d.h})\n\t\t\t\t\t.attr(\"stroke-dasharray\", function(d) {return d.highlight ? \"\" : margin/3 + \",\" + margin/4})\n\n\t\t\t\tdatalabelText = g\n\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t.attr(\"class\", \"data-label-text\")\n\t\t\t\t\t.selectAll(\"text\")\n\t\t\t\t\t.data(customLegend)\n\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t.attr(\"class\", function(d) {return d.class})\n\t\t\t\t\t.attr(\"x\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"y\", function(d) {return d.y + d.h})\n\t\t\t\t\t.attr(\"dy\", margin * 1.5)\n\t\t\t\t\t.attr(\"stroke-width\", 0)\n\t\t\t\t\t.attr(\"font-weight\", function(d) {return d.highlight ? \"bold\" : \"normal\"})\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\n\n\t\t\t\tdatalabelText\n\t\t\t\t\t.append(\"tspan\")\n\t\t\t\t\t.attr(\"x\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"dx\", viewsUnitScale.range()[1])\n\t\t\t\t\t.text(function(d) {return d.name[0]});\n\n\t\t\t\tdatalabelText\n\t\t\t\t\t.append(\"tspan\")\n\t\t\t\t\t.attr(\"x\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"dy\", 16)\n\t\t\t\t\t.attr(\"dx\", viewsUnitScale.range()[1])\n\t\t\t\t\t.text(function(d) {return d.name[1]});\n\n\t\t\t\treturn g;\n\t\t\t}\n\n\t\t\tfunction mappedViewsData(_data) {\n\t\t\t\treturn _data.map(function(p, index) {\n\t\t\t\t\tvar unitSum = Math.floor(p[labels[3]]/masterunit),\n\t\t\t\t\t\tremain = p[labels[3]] % masterunit,\n\t\t\t\t\t\tspecHorUnits = index === exceptI ? moreHorUnits : horUnits,\n\t\t\t\t\t\trows = Math.ceil(unitSum/specHorUnits);\n\t\t\t\t\tp.unitArray = [];\n\t\t\t\t\tfor (var i = 0; i < rows; i++) { // eslint-disable-line one-var\n\t\t\t\t\t\tfor (var h = 0; h < specHorUnits; h++) { // eslint-disable-line one-var\n\t\t\t\t\t\t\tp.unitArray.push({ x: h, y: i, value: masterunit })\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tp.unitArray = p.unitArray.slice(0, unitSum); // only take the amount of spaces needed\n\t\t\t\t\tp.unitArray[p.unitArray.length-1].value = remain; // last space is the remainder, not a full masterunit\n\t\t\t\t\tp.Rows = rows;\n\t\t\t\t\treturn p;\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tfunction hover(g, index, e, a, v) { //eslint-disable-line max-params\n\t\t\t\tif (index === null) return g\n\t\t\t\t\t.transition()\n\t\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t\t.transition()\n\t\t\t\t\t.style(\"display\", \"none\");\n\n\t\t\t\tvar editXPos = fAttr(e, \"circle\", index, \"cx\"),\n\t\t\t\t\tartXPos = fAttr(a, \"rect\", index, \"x\"),\n\t\t\t\t\tartW = fAttr(a, \"rect\", index, \"width\"),\n\t\t\t\t\tposInRow = fAttr(v, \".views-\" + index, Math.min(Math.floor(horUnits/2), ddata[index].unitArray.length - 1), \"cx\") + margin,\n\t\t\t\t\tsize = margin,\n\t\t\t\t\tshiftSmScreens = width < minWidth ? 20 : 0,\n\t\t\t\t\thoverLabels = [{\n\t\t\t\t\t\tvalue: ddata[index][labels[1]],\n\t\t\t\t\t\tpath: \"M\" + (editXPos + margin) + \" \" + (yPos(null, index) + margin) + \"v -36h\",\n\t\t\t\t\t\tlabelPos: [editXPos, yPos(null, index) - 36]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: ddata[index][labels[2]],\n\t\t\t\t\t\tpath: \"M\" + (artXPos + margin + artW/2) + \" \" + (yPos(null, index) + margin) + \"v -18h\",\n\t\t\t\t\t\tlabelPos: [artXPos + artW / 2, yPos(null, index) - 18]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: ddata[index][labels[3]],\n\t\t\t\t\t\tpath: \"M\" + posInRow + \" \" + (yPos(null, index) + viewsUnitScale.range()[1]*2) + \"v -6h\",\n\t\t\t\t\t\tlabelPos: [posInRow - margin - shiftSmScreens, yPos(null, index) - 6]\n\t\t\t\t\t}\n\t\t\t\t\t];\n\n\t\t\t\tg\n\t\t\t\t\t.transition()\n\t\t\t\t\t.attr(\"opacity\", 1)\n\t\t\t\t\t.style(\"display\", null)\n\t\t\t\t\t.style(\"pointer-events\", \"none\")\n\n\t\t\t\tg.selectAll(\"path\")\n\t\t\t\t\t.data(hoverLabels)\n\t\t\t\t\t.join(\"path\")\n\t\t\t\t\t.attr(\"class\", \"hover-label-lines\")\n\t\t\t\t\t.attr(\"d\", function(d) {return d.path})\n\t\t\t\t\t.style(\"display\", function(d, i) {return checks[i].is(\":checked\") ? \"block\" : \"none\" });\n\n\t\t\t\tg.selectAll(\"text\")\n\t\t\t\t\t.data(hoverLabels)\n\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t.attr(\"x\", function(d) {return d.labelPos[0]})\n\t\t\t\t\t.attr(\"y\", function(d) {return d.labelPos[1]})\n\t\t\t\t\t.attr(\"dy\", margin*0.5)\n\t\t\t\t\t.attr(\"dx\", margin*2)\n\t\t\t\t\t.text(function(d) {return numFormat(d.value)})\n\t\t\t\t\t.style(\"display\", function(d, i) {return checks[i].is(\":checked\") ? \"block\" : \"none\" });\n\n\t\t\t\tif (labels.length > 4) g.append(\"text\")\n\t\t\t\t\t.attr(\"x\", screenWidth < smallBp ? xPos(0, index) : xPos(0, index) + margin)\n\t\t\t\t\t.attr(\"y\", yPos(null, index) + shift.y)\n\t\t\t\t\t.attr(\"dy\", -margin)\n\t\t\t\t\t.attr(\"dx\", margin)\n\t\t\t\t\t.text(ddata[index][labels[0]]);\n\n\t\t\t\tg.selectAll(\"image\")\n\t\t\t\t\t.data(hoverLabels)\n\t\t\t\t\t.join(\"image\")\n\t\t\t\t\t.attr(\"xlink:href\", function(d, i) {return icons[i]})\n\t\t\t\t\t.attr(\"width\", size)\n\t\t\t\t\t.attr(\"height\", size)\n\t\t\t\t\t.attr(\"x\", function(d) {return d.labelPos[0] + margin*0.5})\n\t\t\t\t\t.attr(\"y\", function(d) {return d.labelPos[1] - size*0.5})\n\t\t\t\t\t.style(\"display\", function(d, i) {return checks[i].is(\":checked\") ? \"block\" : \"none\" });\n\t\t\t\treturn g;\n\t\t\t}\n\n\t\t\tfunction checkBoxStates() {\n\t\t\t\tfor (var i = 0; i < checks.length; i++) {\n\t\t\t\t\tvar $elem = $(\".profile-feature\" + (i + 1));\n\t\t\t\t\tif (checks[i].is(\":checked\")) {\n\t\t\t\t\t\t$elem.fadeIn();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$elem.fadeOut();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!checks[0].is(\":checked\") && !checks[1].is(\":checked\") && !checks[2].is(\":checked\")) {$(\".main-label-ranks\").fadeIn()}\n\t\t\t\telse {$(\".main-label-ranks\").fadeOut()}\n\t\t\t}\n\n\t\t\tvar svg,\n\t\t\t\teditors,\n\t\t\t\tarticles,\n\t\t\t\tviews,\n\t\t\t\ttooltip,\n\t\t\t\tcontainer = d3.select(\"#\" + id),\n\t\t\t\tchecks = [$(\"#feature1\"), $(\"#feature2\"), $(\"#feature3\")],\n\t\t\t\taspect = width / height,\n\t\t\t\tmappedData = mappedViewsData(data),\n\t\t\t\tddata = mappedData.slice(dataStart, dataEnd),\n\t\t\t\tmaxRows = d3.max(mappedData, function(d) { return d.Rows }),\n\t\t\t\tunitR = 4,\n\t\t\t\teditorScale = d3.scaleLinear()\n\t\t\t\t\t.domain([0, d3.max(data, function(d) { return d[labels[1]] })])\n\t\t\t\t\t.range([0, maxFeature1]), //min and max radius of circle\n\t\t\t\tarticleScale = d3.scaleLinear()\n\t\t\t\t\t.domain([0, d3.max(data, function(d) { return d[labels[2]] })])\n\t\t\t\t\t.range([0, maxFeature2]), //min and max height of rect\n\t\t\t\tviewsUnitScale = d3.scaleLinear()\n\t\t\t\t\t.domain([0, masterunit])\n\t\t\t\t\t.range([0, unitR]), // min and max size of of 1 unit\n\t\t\t\tviewsYScale = d3.scaleLinear()\n\t\t\t\t\t.domain([0, maxRows])\n\t\t\t\t\t.range([0, maxRows * unitR * 2]), // min and max space for rows\n\t\t\t\tviewsXScale = d3.scaleLinear()\n\t\t\t\t\t.domain([0, horUnits])\n\t\t\t\t\t.range([0, horUnits * unitR * 2.5]), // min and max space for columns\n\t\t\t\tminHeight = editorScale.range()[1] * 2 + viewsYScale.range()[1] + (legendLabelDistance + margin) * 4;\n\n\t\t\theight = except && height < minHeight ? minHeight : height; // update\n\t\t\texceptHeightMulti = height/shift.y; // update\n\n\t\t\tsvg = container.append(\"svg\")\n\t\t\t\t.attr(\"width\", width)\n\t\t\t\t.attr(\"height\", height)\n\t\t\t\t.attr(\"perserveAspectRatio\", \"xMidYMid meet\")\n\t\t\t\t.attr(\"viewBox\", \"0 0 \" + width + \" \" + height);\n\n\t\t\t// lazy resize, keeps proportions\n\t\t\t$( window ).resize(function(){\n\t\t\t\tvar targetWidth = container.node().getBoundingClientRect().width;\n\t\t\t\tcontainer.selectAll(\"svg\").attr(\"width\", targetWidth);\n\t\t\t\tcontainer.selectAll(\"svg\").attr(\"height\", targetWidth / aspect);\n\t\t\t});\n\n\t\t\teditors = svg.append(\"g\").call(editorsConstruct);\n\t\t\tarticles = svg.append(\"g\").call(articlesConstruct, editors);\n\t\t\tviews = svg.append(\"g\").call(viewsConstruct, editors, articles);\n\n\t\t\tsvg.append(\"g\").call(labelConstruct, editors, dataStart);\n\t\t\tsvg.append(\"g\").call(borderleft);\n\n\t\t\tif (except) {\n\t\t\t\tsvg.append(\"g\").call(legendConstruct, editors, articles, views);\n\t\t\t} else {\n\t\t\t\ttooltip = svg\n\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"class\", \"tooltip\");\n\n\t\t\t\tsvg\n\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t\t.attr(\"class\", \"tooltipgrid\")\n\t\t\t\t\t.selectAll(\"rect\")\n\t\t\t\t\t.data(ddata)\n\t\t\t\t\t.join(\"rect\")\n\t\t\t\t\t.attr(\"class\", \"hover\")\n\t\t\t\t\t.attr(\"x\", function(d, i) {return xPos(d, i)})\n\t\t\t\t\t.attr(\"y\", function(d, i) {return yPos(d, i)})\n\t\t\t\t\t.attr(\"width\", shift.x)\n\t\t\t\t\t.attr(\"height\", shift.y)\n\t\t\t\t\t.on(\"touchstart mouseover\", function(_, i) {\n\t\t\t\t\t\tif (ddata[i][labels[0]] === exceptLang) return;\n\t\t\t\t\t\ttooltip\n\t\t\t\t\t\t\t.call(hover, i, editors, articles, views);\n\t\t\t\t\t})\n\t\t\t\t\t.on(\"touchend mouseout\", function() {tooltip.call(hover, null)});\n\n\t\t\t\t// applies to all, but only runs once\n\t\t\t\t$(\".chart-options input[type='checkbox']\").click(checkBoxStates);\n\t\t\t\tcheckBoxStates();\n\t\t\t}\n\t\t}\n\n\t\taddVis();\n\t}\n\n\t$(\".d3-dataprofiles\").each(function() {\n\t\tdataProfiles(this.id);\n\t});\n\n\n});\n/* global d3 */\n/* eslint-disable no-magic-numbers */\n\njQuery(document).ready(function($) {\n\n\t'use strict';\n\n\tfunction lineChart(id) {\n\t\tvar $id = $(\"#\" + id),\n\t\t\tmobileThresh = 762,\n\t\t\tisMobile = $(window).width() < mobileThresh,\n\t\t\tmargin = { top: 30, right: isMobile ? 20 : 60, bottom: 60, left: 40 },\n\t\t\torigWidth = $id.width(),\n\t\t\twidth = origWidth - margin.left - margin.right,\n\t\t\torigHeight = 300,\n\t\t\theight = origHeight - margin.top - margin.bottom,\n\t\t\tstrokeWidth = 1.5,\n\t\t\tcircleDiameter = 4,\n\t\t\taccentColorClass = $id.data(\"stroke-color\"),\n\t\t\ttimeFormatPrefs = $id.data(\"time-format\") === \"month\" ? { month: \"long\" } : { month: \"short\", day: \"numeric\", year: \"numeric\" },\n\t\t\tparseTimeFormat = d3.timeParse(\"%Y-%m-%d\"),\n\t\t\tdataRaw = $id.data(\"chart-raw\"),\n\t\t\tdata = dataRaw ? dataRaw.map(parseDates) : null;\n\n\t\tfunction parseDates(wp) {\n\t\t\twp.date = parseTimeFormat(wp.date);\n\t\t\treturn wp;\n\t\t}\n\n\t\tfunction callout(g, value, xPos, evnt) {\n\t\t\tif (!value) return g.style(\"display\", \"none\");\n\t\t\tg\n\t\t\t\t.attr(\"class\", \"tooltip\")\n\t\t\t\t.style(\"display\", null)\n\t\t\t\t.style(\"pointer-events\", \"none\");\n\n\t\t\tvar borderRadius = 2,\n\t\t\t\tlineHeight = 1.2,\n\t\t\t\trect = g.selectAll(\"rect\")\n\t\t\t\t\t.data([null])\n\t\t\t\t\t.join(\"rect\")\n\t\t\t\t\t.attr(\"rx\", borderRadius)\n\t\t\t\t\t.attr(\"ry\", borderRadius),\n\t\t\t\ttext = g.selectAll(\"text\")\n\t\t\t\t\t.data([null])\n\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t.call(function(t) {\n\t\t\t\t\t\treturn t\n\t\t\t\t\t\t\t.selectAll(\"tspan\")\n\t\t\t\t\t\t\t.data(value.split(/\\n/))\n\t\t\t\t\t\t\t.join(\"tspan\")\n\t\t\t\t\t\t\t.attr(\"x\", 0)\n\t\t\t\t\t\t\t.attr(\"y\", function(d, i) { return i * lineHeight + \"em\" })\n\t\t\t\t\t\t\t.style(\"font-weight\", function(_, i) { return i ? null : \"bold\" })\n\t\t\t\t\t\t\t.text(function(d) { return d; })\n\t\t\t\t\t}),\n\t\t\t\tbbox = text.node().getBBox(),\n\t\t\t\tw = bbox.width,\n\t\t\t\th = bbox.height,\n\t\t\t\tttipMar = 10,\n\t\t\t\ttotalMar = ttipMar * 2,\n\t\t\t\tshift = 2;\n\n\t\t\tg.selectAll(\"circle\")\n\t\t\t\t.data([null])\n\t\t\t\t.join(\"circle\")\n\t\t\t\t.attr(\"r\", circleDiameter)\n\t\t\t\t.attr(\"stroke-width\", strokeWidth)\n\t\t\t\t.attr(\"fill\", evnt ? \"none\" : \"white\")\n\n\t\t\trect.attr(\"width\", w + totalMar).attr(\"height\", h + totalMar)\n\n\t\t\tif (xPos + w > width) {\n\t\t\t\ttext.attr(\"transform\", \"translate(\" + (-w - totalMar) + \",\" + -((h - totalMar) / 2 - shift) + \")\");\n\t\t\t\trect.attr(\"x\", -(w + ttipMar + totalMar)).attr(\"y\", -(h + totalMar) / 2);\n\t\t\t} else {\n\t\t\t\ttext.attr(\"transform\", \"translate(\" + totalMar + \",\" + -((h - totalMar) / 2 - shift) + \")\");\n\t\t\t\trect.attr(\"x\", ttipMar).attr(\"y\", -(h + totalMar) / 2);\n\t\t\t}\n\n\t\t\treturn g;\n\t\t}\n\n\t\tfunction addVis() {\n\t\t\tif (!data) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar svg,\n\t\t\t\tticks = { x: 0, y: 4 },\n\t\t\t\tx = d3.scaleTime()\n\t\t\t\t\t.nice()\n\t\t\t\t\t.domain(d3.extent(data, function(d) { return d.date; }))\n\t\t\t\t\t.range([0, width]),\n\t\t\t\txAxis = function(g) {\n\t\t\t\t\tg\n\t\t\t\t\t\t.attr(\"transform\", \"translate(0,\" + height + \")\")\n\t\t\t\t\t\t.call(d3.axisBottom(x)\n\t\t\t\t\t\t\t.ticks(d3.timeMonth, 1)\n\t\t\t\t\t\t\t.tickFormat(isMobile ? d3.timeFormat(\"%b\") : d3.timeFormat(\"%B\")))\n\t\t\t\t\t\t.call(function(h) { h.select(\".domain\").remove(); })\n\t\t\t\t},\n\t\t\t\ty = d3.scaleLinear()\n\t\t\t\t\t.domain([0, d3.max(data, function(d) { return d.value; })])\n\t\t\t\t\t.range([height, 0]),\n\t\t\t\tyAxis = function(g) {\n\t\t\t\t\tg\n\t\t\t\t\t\t.attr(\"class\", \"yAxis\")\n\t\t\t\t\t\t.call(d3.axisLeft(y)\n\t\t\t\t\t\t\t.ticks(ticks.y)\n\t\t\t\t\t\t\t.tickFormat(d3.format(\".2s\"))\n\t\t\t\t\t\t\t.tickSize(-1 * width))\n\t\t\t\t\t\t.call(function(h) { h.select(\".domain\").remove(); })\n\t\t\t\t},\n\t\t\t\tbisectDate = function(mx) {\n\t\t\t\t\tvar bisect = d3.bisector(function(d) { return d.date }).left,\n\t\t\t\t\t\tdate = x.invert(mx),\n\t\t\t\t\t\tindex = bisect(data, date, 1),\n\t\t\t\t\t\ta = data[index - 1],\n\t\t\t\t\t\tb = data[index];\n\t\t\t\t\treturn date - a.date > b.date - date ? b : a;\n\t\t\t\t},\n\t\t\t\ttooltip,\n\t\t\t\tcontainer = d3.select(\"#\" + id),\n\t\t\t\taspect = origWidth / origHeight;\n\n\t\t\tsvg = container.append(\"svg\")\n\t\t\t\t.attr(\"width\", origWidth)\n\t\t\t\t.attr(\"height\", origHeight)\n\t\t\t\t.attr(\"perserveAspectRatio\", \"xMidYMid meet\")\n\t\t\t\t.attr(\"viewBox\", \"0 0 \" + origWidth + \" \" + origHeight)\n\t\t\t\t.append(\"g\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\t\t\t// lazy resize, keeps proportions\n\t\t\t$( window ).resize(function() {\n\t\t\t\tvar targetWidth = container.node().getBoundingClientRect().width;\n\t\t\t\tcontainer.selectAll(\"svg\").attr(\"width\", targetWidth);\n\t\t\t\tcontainer.selectAll(\"svg\").attr(\"height\", targetWidth / aspect);\n\t\t\t});\n\n\t\t\tsvg.append(\"g\").call(xAxis);\n\t\t\tsvg.append(\"g\").call(yAxis);\n\n\t\t\tsvg.append(\"path\")\n\t\t\t\t.datum(data)\n\t\t\t\t.attr(\"fill\", \"none\")\n\t\t\t\t.attr(\"stroke-width\", strokeWidth)\n\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t.attr(\"class\", \"line \" + accentColorClass)\n\t\t\t\t.attr(\"d\", d3.line()\n\t\t\t\t\t.x(function(d) { return x(d.date) })\n\t\t\t\t\t.y(function(d) { return y(d.value) })\n\t\t\t\t);\n\n\t\t\tsvg.append(\"g\")\n\t\t\t\t.selectAll(\"circle\")\n\t\t\t\t.data(data.filter(function(d) { return d.event; }))\n\t\t\t\t.enter(\"circle\")\n\t\t\t\t.append(\"circle\")\n\t\t\t\t.attr(\"class\", \"circle \" + accentColorClass)\n\t\t\t\t.attr(\"r\", circleDiameter)\n\t\t\t\t.attr(\"cx\", function(d) { return x(d.date); })\n\t\t\t\t.attr(\"cy\", function(d) { return y(d.value); });\n\n\t\t\ttooltip = svg.append(\"g\");\n\n\t\t\tsvg.append('rect')\n\t\t\t\t.attr(\"class\", \"overlay\")\n\t\t\t\t.attr(\"pointer-events\", \"all\")\n\t\t\t\t.attr('x', 0)\n\t\t\t\t.attr('y', 0)\n\t\t\t\t.attr('width', width)\n\t\t\t\t.attr('height', height)\n\t\t\t\t.on(\"touchmove mousemove\", function() {\n\t\t\t\t\tvar hoverD = bisectDate(d3.mouse(this)[0]),\n\t\t\t\t\t\tcontext = hoverD.date.toLocaleString(undefined, timeFormatPrefs) + \"\\n\" + d3.format(\",\")(hoverD.value);\n\t\t\t\t\ttooltip\n\t\t\t\t\t\t.attr(\"transform\", \"translate(\" + x(hoverD.date) + \",\" + y(hoverD.value) + \")\")\n\t\t\t\t\t\t.call(callout, context, x(hoverD.date), hoverD.event);\n\t\t\t\t\tif (hoverD.event) {\n\t\t\t\t\t\t$(\"#label-date\").text(hoverD.date.toLocaleString(undefined, timeFormatPrefs));\n\t\t\t\t\t\t$(\"#label-name\").text(hoverD.event);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"opacity\", 1);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"max-height\", 10 + \"rem\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"opacity\", 0);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"max-height\", 2 + \"rem\");\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on(\"touchend mouseleave\", function() {\n\t\t\t\t\ttooltip.call(callout, null);\n\t\t\t\t});\n\t\t}\n\n\t\taddVis();\n\n\t}\n\n\t$(\".d3-linechart\").each(function() {\n\t\tlineChart(this.id);\n\t});\n\n\n});"]}