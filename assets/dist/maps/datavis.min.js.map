{"version":3,"sources":["datavis.min.js"],"names":["jQuery","document","ready","$","each","id","console","log","d3","dataProfiles","this","lineChart","$id","isMobile","window","width","margin","origWidth","origHeight","height","strokeWidth","circleDiameter","accentColorClass","data","timeFormatPrefs","month","day","year","parseTimeFormat","timeParse","dataRaw","map","wp","date","callout","g","value","xPos","evnt","style","attr","rect","selectAll","join","text","call","t","split","d","i","_","bbox","node","getBBox","w","h","totalMar","ttipMar","svg","tooltip","ticks","x","scaleTime","nice","domain","extent","range","y","scaleLinear","max","container","select","aspect","append","on","targetWidth","getBoundingClientRect","axisBottom","timeMonth","tickFormat","timeFormat","remove","axisLeft","format","tickSize","datum","line","filter","event","enter","hoverD","mx","bisect","bisector","left","invert","index","a","b","bisectDate","mouse","context","toLocaleString","undefined","css","addVis"],"mappings":"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","file":"../datavis.min.js","sourcesContent":["/* global d3 */\n/* eslint-disable no-magic-numbers */\n\njQuery(document).ready(function($) {\n\n\t'use strict';\n\n\tfunction dataProfiles(id) {\n\t\tconsole.log(d3, id);\n\t}\n\n\t$(\".d3-dataprofiles\").each(function() {\n\t\tdataProfiles(d3, this.id);\n\t});\n\n\n});\n/* global d3 */\n/* eslint-disable no-magic-numbers */\n\njQuery(document).ready(function($) {\n\n\t'use strict';\n\n\tfunction lineChart(id) {\n\t\tvar $id = $(\"#\" + id),\n\t\t\tmobileThresh = 762,\n\t\t\tisMobile = $(window).width() < mobileThresh,\n\t\t\tmargin = { top: 30, right: isMobile ? 20 : 60, bottom: 60, left: 40 },\n\t\t\torigWidth = $id.width(),\n\t\t\twidth = origWidth - margin.left - margin.right,\n\t\t\torigHeight = 300,\n\t\t\theight = origHeight - margin.top - margin.bottom,\n\t\t\tstrokeWidth = 1.5,\n\t\t\tcircleDiameter = 4,\n\t\t\taccentColorClass = $id.data(\"stroke-color\"),\n\t\t\ttimeFormatPrefs = $id.data(\"time-format\") === \"month\" ? { month: \"long\" } : { month: \"short\", day: \"numeric\", year: \"numeric\" },\n\t\t\tparseTimeFormat = d3.timeParse(\"%Y-%m-%d\"),\n\t\t\tdataRaw = $id.data(\"chart-raw\"),\n\t\t\tdata = dataRaw ? dataRaw.map(parseDates) : null;\n\n\t\tfunction parseDates(wp) {\n\t\t\twp.date = parseTimeFormat(wp.date);\n\t\t\treturn wp;\n\t\t}\n\n\t\tfunction callout(g, value, xPos, evnt) {\n\t\t\tif (!value) return g.style(\"display\", \"none\");\n\t\t\tg\n\t\t\t\t.attr(\"class\", \"tooltip\")\n\t\t\t\t.style(\"display\", null)\n\t\t\t\t.style(\"pointer-events\", \"none\");\n\n\t\t\tvar borderRadius = 2,\n\t\t\t\tlineHeight = 1.2,\n\t\t\t\trect = g.selectAll(\"rect\")\n\t\t\t\t\t.data([null])\n\t\t\t\t\t.join(\"rect\")\n\t\t\t\t\t.attr(\"rx\", borderRadius)\n\t\t\t\t\t.attr(\"ry\", borderRadius),\n\t\t\t\ttext = g.selectAll(\"text\")\n\t\t\t\t\t.data([null])\n\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t.call(function(t) {\n\t\t\t\t\t\treturn t\n\t\t\t\t\t\t\t.selectAll(\"tspan\")\n\t\t\t\t\t\t\t.data(value.split(/\\n/))\n\t\t\t\t\t\t\t.join(\"tspan\")\n\t\t\t\t\t\t\t.attr(\"x\", 0)\n\t\t\t\t\t\t\t.attr(\"y\", function(d, i) { return i * lineHeight + \"em\" })\n\t\t\t\t\t\t\t.style(\"font-weight\", function(_, i) { return i ? null : \"bold\" })\n\t\t\t\t\t\t\t.text(function(d) { return d; })\n\t\t\t\t\t}),\n\t\t\t\tbbox = text.node().getBBox(),\n\t\t\t\tw = bbox.width,\n\t\t\t\th = bbox.height,\n\t\t\t\tttipMar = 10,\n\t\t\t\ttotalMar = ttipMar * 2,\n\t\t\t\tshift = 2;\n\n\t\t\tg.selectAll(\"circle\")\n\t\t\t\t.data([null])\n\t\t\t\t.join(\"circle\")\n\t\t\t\t.attr(\"r\", circleDiameter)\n\t\t\t\t.attr(\"stroke-width\", strokeWidth)\n\t\t\t\t.attr(\"fill\", evnt ? \"none\" : \"white\")\n\n\t\t\trect.attr(\"width\", w + totalMar).attr(\"height\", h + totalMar)\n\n\t\t\tif (xPos + w > width) {\n\t\t\t\ttext.attr(\"transform\", \"translate(\" + (-w - totalMar) + \",\" + -((h - totalMar) / 2 - shift) + \")\");\n\t\t\t\trect.attr(\"x\", -(w + ttipMar + totalMar)).attr(\"y\", -(h + totalMar) / 2);\n\t\t\t} else {\n\t\t\t\ttext.attr(\"transform\", \"translate(\" + totalMar + \",\" + -((h - totalMar) / 2 - shift) + \")\");\n\t\t\t\trect.attr(\"x\", ttipMar).attr(\"y\", -(h + totalMar) / 2);\n\t\t\t}\n\n\t\t\treturn g;\n\t\t}\n\n\t\tfunction addVis() {\n\t\t\tif (!data) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar svg,\n\t\t\t\tticks = { x: 0, y: 4 },\n\t\t\t\tx = d3.scaleTime()\n\t\t\t\t\t.nice()\n\t\t\t\t\t.domain(d3.extent(data, function(d) { return d.date; }))\n\t\t\t\t\t.range([0, width]),\n\t\t\t\txAxis = function(g) {\n\t\t\t\t\tg\n\t\t\t\t\t\t.attr(\"transform\", \"translate(0,\" + height + \")\")\n\t\t\t\t\t\t.call(d3.axisBottom(x)\n\t\t\t\t\t\t\t.ticks(d3.timeMonth, 1)\n\t\t\t\t\t\t\t.tickFormat(isMobile ? d3.timeFormat(\"%b\") : d3.timeFormat(\"%B\")))\n\t\t\t\t\t\t.call(function(h) { h.select(\".domain\").remove(); })\n\t\t\t\t},\n\t\t\t\ty = d3.scaleLinear()\n\t\t\t\t\t.domain([0, d3.max(data, function(d) { return d.value; })])\n\t\t\t\t\t.range([height, 0]),\n\t\t\t\tyAxis = function(g) {\n\t\t\t\t\tg\n\t\t\t\t\t\t.attr(\"class\", \"yAxis\")\n\t\t\t\t\t\t.call(d3.axisLeft(y)\n\t\t\t\t\t\t\t.ticks(ticks.y)\n\t\t\t\t\t\t\t.tickFormat(d3.format(\".2s\"))\n\t\t\t\t\t\t\t.tickSize(-1 * width))\n\t\t\t\t\t\t.call(function(h) { h.select(\".domain\").remove(); })\n\t\t\t\t},\n\t\t\t\tbisectDate = function(mx) {\n\t\t\t\t\tvar bisect = d3.bisector(function(d) { return d.date }).left,\n\t\t\t\t\t\tdate = x.invert(mx),\n\t\t\t\t\t\tindex = bisect(data, date, 1),\n\t\t\t\t\t\ta = data[index - 1],\n\t\t\t\t\t\tb = data[index];\n\t\t\t\t\treturn date - a.date > b.date - date ? b : a;\n\t\t\t\t},\n\t\t\t\ttooltip,\n\t\t\t\tcontainer = d3.select(\"#\" + id),\n\t\t\t\taspect = origWidth / origHeight;\n\n\t\t\tsvg = container.append(\"svg\")\n\t\t\t\t.attr(\"width\", origWidth)\n\t\t\t\t.attr(\"height\", origHeight)\n\t\t\t\t.attr(\"perserveAspectRatio\", \"xMidYMid meet\")\n\t\t\t\t.attr(\"viewBox\", \"0 0 \" + origWidth + \" \" + origHeight)\n\t\t\t\t.append(\"g\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\t\t\t// lazy resize, keeps proportions\n\t\t\td3.select(window)\n\t\t\t\t.on(\"resize\", function() {\n\t\t\t\t\tvar targetWidth = container.node().getBoundingClientRect().width;\n\t\t\t\t\tcontainer.selectAll(\"svg\").attr(\"width\", targetWidth);\n\t\t\t\t\tcontainer.selectAll(\"svg\").attr(\"height\", targetWidth / aspect);\n\t\t\t\t});\n\n\t\t\tsvg.append(\"g\").call(xAxis);\n\t\t\tsvg.append(\"g\").call(yAxis);\n\n\t\t\tsvg.append(\"path\")\n\t\t\t\t.datum(data)\n\t\t\t\t.attr(\"fill\", \"none\")\n\t\t\t\t.attr(\"stroke-width\", strokeWidth)\n\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t.attr(\"class\", \"line \" + accentColorClass)\n\t\t\t\t.attr(\"d\", d3.line()\n\t\t\t\t\t.x(function(d) { return x(d.date) })\n\t\t\t\t\t.y(function(d) { return y(d.value) })\n\t\t\t\t);\n\n\t\t\tsvg.append(\"g\")\n\t\t\t\t.selectAll(\"circle\")\n\t\t\t\t.data(data.filter(function(d) { return d.event; }))\n\t\t\t\t.enter(\"circle\")\n\t\t\t\t.append(\"circle\")\n\t\t\t\t.attr(\"class\", \"circle \" + accentColorClass)\n\t\t\t\t.attr(\"r\", circleDiameter)\n\t\t\t\t.attr(\"cx\", function(d) { return x(d.date); })\n\t\t\t\t.attr(\"cy\", function(d) { return y(d.value); });\n\n\t\t\ttooltip = svg.append(\"g\");\n\n\t\t\tsvg.append('rect')\n\t\t\t\t.attr(\"class\", \"overlay\")\n\t\t\t\t.attr(\"pointer-events\", \"all\")\n\t\t\t\t.attr('x', 0)\n\t\t\t\t.attr('y', 0)\n\t\t\t\t.attr('width', width)\n\t\t\t\t.attr('height', height)\n\t\t\t\t.on(\"touchmove mousemove\", function() {\n\t\t\t\t\tvar hoverD = bisectDate(d3.mouse(this)[0]),\n\t\t\t\t\t\tcontext = hoverD.date.toLocaleString(undefined, timeFormatPrefs) + \"\\n\" + d3.format(\",\")(hoverD.value);\n\t\t\t\t\ttooltip\n\t\t\t\t\t\t.attr(\"transform\", \"translate(\" + x(hoverD.date) + \",\" + y(hoverD.value) + \")\")\n\t\t\t\t\t\t.call(callout, context, x(hoverD.date), hoverD.event);\n\t\t\t\t\tif (hoverD.event) {\n\t\t\t\t\t\t$(\"#label-date\").text(hoverD.date.toLocaleString(undefined, timeFormatPrefs));\n\t\t\t\t\t\t$(\"#label-name\").text(hoverD.event);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"opacity\", 1);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"max-height\", 10 + \"rem\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"opacity\", 0);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"max-height\", 2 + \"rem\");\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on(\"touchend mouseleave\", function() {\n\t\t\t\t\ttooltip.call(callout, null);\n\t\t\t\t});\n\t\t}\n\n\t\taddVis();\n\n\t}\n\n\t$(\".d3-linechart\").each(function() {\n\t\tlineChart(this.id);\n\t});\n\n\n});"]}