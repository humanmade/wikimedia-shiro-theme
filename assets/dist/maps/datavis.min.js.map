{"version":3,"sources":["datavis.min.js"],"names":["jQuery","document","ready","$","lineChart","id","$id","isMobile","window","width","margin","origWidth","origHeight","height","strokeWidth","circleDiameter","accentColorClass","data","timeFormatPrefs","month","day","year","parseTimeFormat","d3","timeParse","dataRaw","map","wp","date","callout","g","value","xPos","evnt","style","attr","rect","selectAll","join","text","call","t","split","d","i","_","bbox","node","getBBox","w","h","totalMar","ttipMar","svg","tooltip","ticks","x","scaleTime","nice","domain","extent","range","y","scaleLinear","max","container","select","aspect","append","on","targetWidth","getBoundingClientRect","axisBottom","timeMonth","tickFormat","timeFormat","remove","axisLeft","format","tickSize","datum","line","filter","event","enter","hoverD","mx","bisect","bisector","left","invert","index","a","b","bisectDate","mouse","this","context","toLocaleString","undefined","css","addVis","each"],"mappings":"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","file":"../datavis.min.js","sourcesContent":["/* global d3 */\n/* eslint-disable no-magic-numbers */\n\njQuery(document).ready(function($) {\n\n\t'use strict';\n\n\tfunction lineChart(id) {\n\t\tvar $id = $(\"#\" + id),\n\t\t\tmobileThresh = 762,\n\t\t\tisMobile = $(window).width() < mobileThresh,\n\t\t\tmargin = { top: 30, right: isMobile ? 20 : 60, bottom: 60, left: 40 },\n\t\t\torigWidth = $id.width(),\n\t\t\twidth = origWidth - margin.left - margin.right,\n\t\t\torigHeight = 300,\n\t\t\theight = origHeight - margin.top - margin.bottom,\n\t\t\tstrokeWidth = 1.5,\n\t\t\tcircleDiameter = 4,\n\t\t\taccentColorClass = $id.data(\"stroke-color\"),\n\t\t\ttimeFormatPrefs = $id.data(\"time-format\") === \"month\" ? { month: \"long\" } : { month: \"short\", day: \"numeric\", year: \"numeric\" },\n\t\t\tparseTimeFormat = d3.timeParse(\"%Y-%m-%d\"),\n\t\t\tdataRaw = $id.data(\"chart-raw\"),\n\t\t\tdata = dataRaw ? dataRaw.map(parseDates) : null;\n\n\t\tfunction parseDates(wp) {\n\t\t\twp.date = parseTimeFormat(wp.date);\n\t\t\treturn wp;\n\t\t}\n\n\t\tfunction callout(g, value, xPos, evnt) {\n\t\t\tif (!value) return g.style(\"display\", \"none\");\n\t\t\tg\n\t\t\t\t.attr(\"class\", \"tooltip\")\n\t\t\t\t.style(\"display\", null)\n\t\t\t\t.style(\"pointer-events\", \"none\");\n\n\t\t\tvar borderRadius = 2,\n\t\t\t\tlineHeight = 1.2,\n\t\t\t\trect = g.selectAll(\"rect\")\n\t\t\t\t\t.data([null])\n\t\t\t\t\t.join(\"rect\")\n\t\t\t\t\t.attr(\"rx\", borderRadius)\n\t\t\t\t\t.attr(\"ry\", borderRadius),\n\t\t\t\ttext = g.selectAll(\"text\")\n\t\t\t\t\t.data([null])\n\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t.call(function(t) {\n\t\t\t\t\t\treturn t\n\t\t\t\t\t\t\t.selectAll(\"tspan\")\n\t\t\t\t\t\t\t.data(value.split(/\\n/))\n\t\t\t\t\t\t\t.join(\"tspan\")\n\t\t\t\t\t\t\t.attr(\"x\", 0)\n\t\t\t\t\t\t\t.attr(\"y\", function(d, i) { return i * lineHeight + \"em\" })\n\t\t\t\t\t\t\t.style(\"font-weight\", function(_, i) { return i ? null : \"bold\" })\n\t\t\t\t\t\t\t.text(function(d) { return d; })\n\t\t\t\t\t}),\n\t\t\t\tbbox = text.node().getBBox(),\n\t\t\t\tw = bbox.width,\n\t\t\t\th = bbox.height,\n\t\t\t\tttipMar = 10,\n\t\t\t\ttotalMar = ttipMar * 2,\n\t\t\t\tshift = 2;\n\n\t\t\tg.selectAll(\"circle\")\n\t\t\t\t.data([null])\n\t\t\t\t.join(\"circle\")\n\t\t\t\t.attr(\"r\", circleDiameter)\n\t\t\t\t.attr(\"stroke-width\", strokeWidth)\n\t\t\t\t.attr(\"fill\", evnt ? \"none\" : \"white\")\n\n\t\t\trect.attr(\"width\", w + totalMar).attr(\"height\", h + totalMar)\n\n\t\t\tif (xPos + w > width) {\n\t\t\t\ttext.attr(\"transform\", \"translate(\" + (-w - totalMar) + \",\" + -((h - totalMar) / 2 - shift) + \")\");\n\t\t\t\trect.attr(\"x\", -(w + ttipMar + totalMar)).attr(\"y\", -(h + totalMar) / 2);\n\t\t\t} else {\n\t\t\t\ttext.attr(\"transform\", \"translate(\" + totalMar + \",\" + -((h - totalMar) / 2 - shift) + \")\");\n\t\t\t\trect.attr(\"x\", ttipMar).attr(\"y\", -(h + totalMar) / 2);\n\t\t\t}\n\n\t\t\treturn g;\n\t\t}\n\n\t\tfunction addVis() {\n\t\t\tif (!data) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar svg,\n\t\t\t\tticks = { x: 0, y: 4 },\n\t\t\t\tx = d3.scaleTime()\n\t\t\t\t\t.nice()\n\t\t\t\t\t.domain(d3.extent(data, function(d) { return d.date; }))\n\t\t\t\t\t.range([0, width]),\n\t\t\t\txAxis = function(g) {\n\t\t\t\t\tg\n\t\t\t\t\t\t.attr(\"transform\", \"translate(0,\" + height + \")\")\n\t\t\t\t\t\t.call(d3.axisBottom(x)\n\t\t\t\t\t\t\t.ticks(d3.timeMonth, 1)\n\t\t\t\t\t\t\t.tickFormat(isMobile ? d3.timeFormat(\"%b\") : d3.timeFormat(\"%B\")))\n\t\t\t\t\t\t.call(function(h) { h.select(\".domain\").remove(); })\n\t\t\t\t},\n\t\t\t\ty = d3.scaleLinear()\n\t\t\t\t\t.domain([0, d3.max(data, function(d) { return d.value; })])\n\t\t\t\t\t.range([height, 0]),\n\t\t\t\tyAxis = function(g) {\n\t\t\t\t\tg\n\t\t\t\t\t\t.attr(\"class\", \"yAxis\")\n\t\t\t\t\t\t.call(d3.axisLeft(y)\n\t\t\t\t\t\t\t.ticks(ticks.y)\n\t\t\t\t\t\t\t.tickFormat(d3.format(\".2s\"))\n\t\t\t\t\t\t\t.tickSize(-1 * width))\n\t\t\t\t\t\t.call(function(h) { h.select(\".domain\").remove(); })\n\t\t\t\t},\n\t\t\t\tbisectDate = function(mx) {\n\t\t\t\t\tvar bisect = d3.bisector(function(d) { return d.date }).left,\n\t\t\t\t\t\tdate = x.invert(mx),\n\t\t\t\t\t\tindex = bisect(data, date, 1),\n\t\t\t\t\t\ta = data[index - 1],\n\t\t\t\t\t\tb = data[index];\n\t\t\t\t\treturn date - a.date > b.date - date ? b : a;\n\t\t\t\t},\n\t\t\t\ttooltip,\n\t\t\t\tcontainer = d3.select(\"#\" + id),\n\t\t\t\taspect = origWidth / origHeight;\n\n\t\t\tsvg = container.append(\"svg\")\n\t\t\t\t.attr(\"width\", origWidth)\n\t\t\t\t.attr(\"height\", origHeight)\n\t\t\t\t.attr(\"perserveAspectRatio\", \"xMidYMid meet\")\n\t\t\t\t.attr(\"viewBox\", \"0 0 \" + origWidth + \" \" + origHeight)\n\t\t\t\t.append(\"g\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\t\t\t// lazy resize, keeps proportions\n\t\t\td3.select(window)\n\t\t\t\t.on(\"resize\", function() {\n\t\t\t\t\tvar targetWidth = container.node().getBoundingClientRect().width;\n\t\t\t\t\tcontainer.selectAll(\"svg\").attr(\"width\", targetWidth);\n\t\t\t\t\tcontainer.selectAll(\"svg\").attr(\"height\", targetWidth / aspect);\n\t\t\t\t});\n\n\t\t\tsvg.append(\"g\").call(xAxis);\n\t\t\tsvg.append(\"g\").call(yAxis);\n\n\t\t\tsvg.append(\"path\")\n\t\t\t\t.datum(data)\n\t\t\t\t.attr(\"fill\", \"none\")\n\t\t\t\t.attr(\"stroke-width\", strokeWidth)\n\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t.attr(\"class\", \"line \" + accentColorClass)\n\t\t\t\t.attr(\"d\", d3.line()\n\t\t\t\t\t.x(function(d) { return x(d.date) })\n\t\t\t\t\t.y(function(d) { return y(d.value) })\n\t\t\t\t);\n\n\t\t\tsvg.append(\"g\")\n\t\t\t\t.selectAll(\"circle\")\n\t\t\t\t.data(data.filter(function(d) { return d.event; }))\n\t\t\t\t.enter(\"circle\")\n\t\t\t\t.append(\"circle\")\n\t\t\t\t.attr(\"class\", \"circle \" + accentColorClass)\n\t\t\t\t.attr(\"r\", circleDiameter)\n\t\t\t\t.attr(\"cx\", function(d) { return x(d.date); })\n\t\t\t\t.attr(\"cy\", function(d) { return y(d.value); });\n\n\t\t\ttooltip = svg.append(\"g\");\n\n\t\t\tsvg.append('rect')\n\t\t\t\t.attr(\"class\", \"overlay\")\n\t\t\t\t.attr(\"pointer-events\", \"all\")\n\t\t\t\t.attr('x', 0)\n\t\t\t\t.attr('y', 0)\n\t\t\t\t.attr('width', width)\n\t\t\t\t.attr('height', height)\n\t\t\t\t.on(\"touchmove mousemove\", function() {\n\t\t\t\t\tvar hoverD = bisectDate(d3.mouse(this)[0]),\n\t\t\t\t\t\tcontext = hoverD.date.toLocaleString(undefined, timeFormatPrefs) + \"\\n\" + d3.format(\",\")(hoverD.value);\n\t\t\t\t\ttooltip\n\t\t\t\t\t\t.attr(\"transform\", \"translate(\" + x(hoverD.date) + \",\" + y(hoverD.value) + \")\")\n\t\t\t\t\t\t.call(callout, context, x(hoverD.date), hoverD.event);\n\t\t\t\t\tif (hoverD.event) {\n\t\t\t\t\t\t$(\"#label-date\").text(hoverD.date.toLocaleString(undefined, timeFormatPrefs));\n\t\t\t\t\t\t$(\"#label-name\").text(hoverD.event);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"opacity\", 1);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"max-height\", 10 + \"rem\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"opacity\", 0);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"max-height\", 2 + \"rem\");\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on(\"touchend mouseleave\", function() {\n\t\t\t\t\ttooltip.call(callout, null);\n\t\t\t\t});\n\t\t}\n\n\t\taddVis();\n\n\t}\n\n\t$(\".d3-chart\").each(function() {\n\t\tlineChart(this.id);\n\t});\n\n\n});"]}